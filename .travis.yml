language: python

python:
- 3.6

os:
- linux

git:
  depth: false

addons:
  apt:
    packages:
    - swig

services: docker

sudo: required

env:
  global:
  - REPO_DIR=.
  - UNICODE_WIDTH=32
  - PLAT=x86_64
  - MB_PYTHON_VERSION=$TRAVIS_PYTHON_VERSION
  - VERSION=$(echo $TRAVIS_TAG)
  - BUILD_DEPENDS="cmake"
  - CONFIG_PATH=scripts/config.sh
  - TEST_DEPENDS="pytest"

matrix:
  fast_finish: true
  exclude:
  - python: 3.6
  include:
  - os: linux
    env: MB_PYTHON_VERSION=2.7
  - os: linux
    env: MB_PYTHON_VERSION=3.4
  - os: linux
    env: MB_PYTHON_VERSION=3.5
  - os: linux
    env:
      - MB_PYTHON_VERSION=3.6
  - os: linux
    env:
      - MB_PYTHON_VERSION=3.7
      - SOURCEDEPLOY=1

before_install:
  - echo "PWD is $PWD"
  - unset -f pushd
  - unset -f popd
  - git clone https://github.com/matthew-brett/multibuild
  - ls -l
  - source multibuild/common_utils.sh
  - source multibuild/travis_steps.sh
  - before_install

install:
  - pip install bandit
  - build_wheel $REPO_DIR $PLAT

before_script:
  - bandit -c bandit.yml -r src/xtgeo

script:
- install_run $PLAT
- mv wheelhouse dist

after_success:
- ls -l ${TRAVIS_BUILD_DIR}/dist

before_deploy:
- pip install numpy

deploy:
  provider: pypi
  skip_cleanup: true
  skip_upload_docs: true
  distributions: build
  user: $PYPI_USER
  password: $PYPI_PASSWORD
    # secure: "Aoc3SWtqUOsVGBWXwVpBjDWakeyzvwa8n1XB6rs/m4YN27acK/mkKBRvE5xrcgVLPcgkU8C+83IrVOnbp8WvMMkrrLLYSGYVD3VXi3DjHnB+9Jd8jEpHDVveBmI9YnTlZtiQ2PAeF6up19zyyb9MPTy/EOcJkGnUWqsQO17Fh/LNs8pv9IzOtgV5yrhbOARV1CfYTjLI+OOGMycrXMn2sp2k1O5SbgQ9nTtkJKYI+MZeRdbKFP+pHnsi/xeKjEOozIrncSe/m3u1SbwygXuAt/TNn0Bxj7iKVXb+qcJZD2fT11UkDvRwt0o5WWS056Da8PjQgfXiT+TAETv/WTpUKA07hDae080Nns+rfIB83uvkiqNWOygg7vt3sEngTeEmsAIaPBDIeZ/LBHJnaV03I9ooGzNqX6jXj0yKzzFPky9pbpjiqgNRphu2fWoXthvOwjUmP0KJh4kkSOSqc+al6iNXjZJXbUeMw6CJsCOeo63yNyB3B5o8YB7SD87qxhL3u2+cSVsoLdLy2RtRWj4KarqvcaL0bmHNE2pFyBnI6eKEFTuKKZ1eySIDVKva0jnMBW2xUWwa5+1E+P+6M08G5aODNBdmtwbaR44v43EVrAaFtxBiL8Yb5Ws/2ldf44pmR77p5dXu5w2RB5y+HkKFzRxSbP+ok42H0X4Hwzx5YPg="
  on:
    tags: True
    repo: equinor/xtgeo
    # condition: -z $SOURCEDEPLOY
