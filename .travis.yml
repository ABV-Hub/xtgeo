language: python

python:
- 3.6

os:
- linux

git:
  depth: false

addons:
  apt:
    packages:
    - swig

services: docker

sudo: required

env:
  global:
  - REPO_DIR=.
  - UNICODE_WIDTH=32
  - PLAT=x86_64
  - MB_PYTHON_VERSION=$TRAVIS_PYTHON_VERSION
  - VERSION=$(echo $TRAVIS_TAG)
  - BUILD_DEPENDS="cmake"
  - CONFIG_PATH=scripts/config.sh
  - TEST_DEPENDS="pytest"

matrix:
  fast_finish: true
  exclude:
  - python: 3.6
  include:
  - os: linux
    env: MB_PYTHON_VERSION=2.7
  - os: linux
    env: MB_PYTHON_VERSION=3.4
  - os: linux
    env: MB_PYTHON_VERSION=3.5
  - os: linux
    env:
      - MB_PYTHON_VERSION=3.6
  - os: linux
    env:
      - MB_PYTHON_VERSION=3.7
      - SOURCEDEPLOY=1

before_install:
  - echo "PWD is $PWD"
  - unset -f pushd
  - unset -f popd
  - git clone https://github.com/matthew-brett/multibuild
  - ls -l
  - source multibuild/common_utils.sh
  - source multibuild/travis_steps.sh
  - before_install

install:
  - pip install bandit
  - build_wheel $REPO_DIR $PLAT

before_script:
  - bandit -c bandit.yml -r src/xtgeo

script:
- install_run $PLAT
- mv wheelhouse dist

after_success:
- ls -l ${TRAVIS_BUILD_DIR}/dist

before_deploy:
- pip install numpy

deploy:
  provider: pypi
  skip_cleanup: true
  skip_upload_docs: true
  distributions: build
  user: $PYPI_USER
  password:
    secure: "wSNkuWv2kz9911FYhrYuIDMJKSvBCmNwI1cgEVBnmX5mIr3s19/1C8BNqV1v3GvVKbvAA6zkV+lHbwvNbL0GmPsi3e43pi2zajGTenhLXmstMmwqT9Aw8y8tUzQJSv+rY7FgvFWDrFvybqf2BjCUJGXYt8XqUveBYwnwgWG5Hb+FYeNRClxRQwD7gR+G22pOD4FjXLU+9L34J/eet99lGBcPlapg+RC79OQxz000ejUVhZQmVpmCeQywWu5NIugYm/MLFcAJahPnDko78uuRoW7btVgDjUrHBSOwOtNdIBOYHZovSH9n21OoeG8gB7eXuVXADFAn6sAxdJ6Y8ssOVeKETLZ7y6sQX+MG/oTMb2yJd//o30NIILh1TBx6dCwzeNc4PM1dHwD++I7duv6W9N/fvC36mjj7WMNDLJbD37ljjshQ+6XTGhmJR4+RPtF81NkVl8FBLqAsp/FLTTK+bGF9S1Vx+okKFVT7e/gx9aSmBfcEvrtbtQIW1gHUV5kXGqmyKcANiV5qs7eNB6zWuMKYDohcjUfBCVc9UM4pZrWd9I2IUivAkWIKvtf/u1HAXJ/MDPj+adQSHT0F9SKEU1aTIPjoHiXZ+t9wURFpVhkT/c50of7HJTaEu0PpAeFrzQfVucPl35PZ3OQQ/3MskrCxEvOuFv+RpGlxlVr04TA="
  on:
    tags: True
    repo: equinor/xtgeo
    # condition: -z $SOURCEDEPLOY
