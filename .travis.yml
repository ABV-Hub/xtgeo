language: python

python:
- 3.6

os:
- linux

git:
  depth: false

addons:
  apt:
    packages:
    - swig

services: docker

sudo: required

env:
  global:
  - REPO_DIR=.
  - UNICODE_WIDTH=32
  - PLAT=x86_64
  - MB_PYTHON_VERSION=$TRAVIS_PYTHON_VERSION
  - VERSION=$(echo $TRAVIS_TAG)
  - BUILD_DEPENDS="cmake"
  - CONFIG_PATH=scripts/config.sh
  - TEST_DEPENDS="pytest"

matrix:
  fast_finish: true
  exclude:
  - python: 3.6
  include:
  - os: linux
    env: MB_PYTHON_VERSION=2.7
  - os: linux
    env: MB_PYTHON_VERSION=3.4
  - os: linux
    env: MB_PYTHON_VERSION=3.5
  - os: linux
    env:
      - MB_PYTHON_VERSION=3.6
  - os: linux
    env:
      - MB_PYTHON_VERSION=3.7
      - SOURCEDEPLOY=1

before_install:
  - echo "PWD is $PWD"
  - unset -f pushd
  - unset -f popd
  - git clone https://github.com/matthew-brett/multibuild
  - ls -l
  - source multibuild/common_utils.sh
  - source multibuild/travis_steps.sh
  - before_install

install:
  - pip install bandit
  - build_wheel $REPO_DIR $PLAT

before_script:
  - bandit -c bandit.yml -r src/xtgeo

script:
- install_run $PLAT
- mv wheelhouse dist

after_success:
- ls -l ${TRAVIS_BUILD_DIR}/dist

before_deploy:
- pip install numpy

deploy:
  - provider: pypi
    skip_cleanup: true
    skip_upload_docs: true
    distributions: build
    user: statoil-travis
    password:
      secure: "gXxUX6LW9TnFDPYJdFzv2uZMpdOvJggc6xy2j0nUeuIB6K02qeQNXFs1FEZbVvJxvQ4e2rTFlQg2V7DjeMpjlWZDNBlNgE8AFczoKRpeh+NH/qcoEtdX5nfhKJ45RWdz+lg9DLGqGVPU8bFw/my1HPnZqeNIWCtMcp2iwvty0dzOMPivKbSJkrEh1yo7bDzTOmDrcHqKDQavizqzgbrizYpDRcMflbuucl8tA8EQp8L0Kz8RKfROAnq7JorU2XAS27lc7lir7QMfQQ7birnKIfA44byRqKhEi6Ih3PQc21gFVA5maIjVAW8+coAK1F30GYB6NSjMxfV0ZMet6Z4HnXSkwE0j+MZDXM7AtPdVmTMPPbBdkWBBHwJuxIKku1IhfeAsmDA5WecC3OoJXOm8YF0iCvdIrfg83Kx5OgafMb//QTprmap0daMI6rGZEUUFyaGYEPzD9RIOO/Hhu1SZ+5TQWVIWdE0Um2njF3jc9JteRwOESgEMrT60BLQ6jiABxnxppnc2EUBoNyzurNNpvY1VZSL/mQ3lToZJbw8mg9sSmtbq7BJQpGlN4+c21xe2UD2f9QijufFfmxQMVfiUNdsx8fW1dgrfwf4uIYn8Lv012YqynCVTQ5UORGrCkKV3xELu8oQgIJvpc3vKI77fLNtfnjQF5HX5HjxmY4y3DIU="
    on:
      tags: True
      repo: equinor/xtgeo
      # condition: -z $SOURCEDEPLOY
